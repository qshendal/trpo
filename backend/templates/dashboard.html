<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–¢–µ—Ö–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ ‚Äî –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='Panel.css') }}">
</head>
<body>
  <div class="container">
    <aside class="sidebar">
      <h1 class="logo">üîß –¢–µ—Ö–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ</h1>
      <p class="subtitle">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Ö–Ω–∏–∫–æ–π</p>
      <nav class="menu">
        <ul>
          <li class="active"><a href="{{ url_for('dashboard') }}"><i class="fas fa-tachometer-alt"></i> –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</a></li>
          <li><a href="{{ url_for('work_planning') }}"><i class="fas fa-calendar-alt"></i> –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç</a></li>
          <li><a href="{{ url_for('equipment_registry') }}"><i class="fas fa-boxes"></i> –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</a></li>
          <li><a href="{{ url_for('reports') }}"><i class="fas fa-chart-bar"></i> –û—Ç—á—ë—Ç—ã</a></li>
        </ul>
      </nav>
    </aside>

    <main class="dashboard">
      <header class="top-bar">
        <h2>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h2>
      </header>

      <section class="task-section">
        <div class="task-box">
          <div class="task-info">
            <div class="task-title">–ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏</div>
            <div class="task-count" id="activeCount">0</div>
          </div>
          <i class="fas fa-wrench task-icon"></i>
        </div>

        <div class="task-box">
          <div class="task-info">
            <div class="task-title">–ú–∞–ª—ã–µ –∑–∞–ø–∞—Å—ã</div>
            <div class="task-count" id="lowStockCount">0</div>
          </div>
          <i class="fas fa-box-open task-icon" style="color: #e67e22;"></i>
        </div>

        <div class="task-box">
          <div class="task-info">
            <div class="task-title">–†–∞—Å—Ö–æ–¥—ã –∑–∞ –º–µ—Å—è—Ü</div>
            <div class="task-count" id="monthlyExpenses">0</div>
          </div>
          <i class="fas fa-money-bill-wave task-icon" style="color: #27ae60;"></i>
        </div>

        <div class="task-box">
          <div class="task-info">
            <div class="task-title">–ú–∞—Å—Ç–µ—Ä–∞</div>
            <div class="task-count" id="technicianCount">0</div>
          </div>
          <i class="fas fa-user-cog task-icon" style="color: #3498db;"></i>
        </div>
      </section>

      <section class="task-section">
        <div class="task-box task-full">
          <div class="task-header">
            <div class="task-title">–¢–µ–∫—É—â–∏–µ –∑–∞–¥–∞—á–∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è</div>
          </div>
          <div class="task-inner-cards" id="maintenanceTasks"></div>
        </div>

        <div class="task-box task-full">
          <div class="task-header">
            <div class="task-title">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –º–∞–ª—ã—Ö –∑–∞–ø–∞—Å–∞—Ö</div>
            <button class="action-btn" onclick="window.location.href='/equipment-registry'">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∫–ª–∞–¥–æ–º</button>
          </div>
          <div class="task-inner-cards" id="lowStockAlerts"></div>
        </div>
      </section>
    </main>
  </div>

  <script>
    function addTaskCard({ name, type, deadline, priorityText, priorityClass }) {
      const card = document.createElement('div');
      card.className = 'task-subcard';

      const left = document.createElement('div');
      left.className = 'task-subcard-left';

      const nameEl = document.createElement('div');
      nameEl.className = 'task-name';
      nameEl.textContent = name;
      left.appendChild(nameEl);

      const typeEl = document.createElement('div');
      typeEl.className = 'task-type';
      typeEl.textContent = type;
      left.appendChild(typeEl);

      const deadlineEl = document.createElement('div');
      deadlineEl.className = 'task-deadline';
      deadlineEl.textContent = deadline;
      left.appendChild(deadlineEl);

      const right = document.createElement('div');
      right.className = 'task-subcard-right';

      const priorityBlock = document.createElement('div');
      priorityBlock.className = `task-priority ${priorityClass}`;
      priorityBlock.textContent = priorityText;
      right.appendChild(priorityBlock);

      card.appendChild(left);
      card.appendChild(right);

      document.getElementById('maintenanceTasks').appendChild(card);
    }

      function addStockCard({ –Ω–∞–∑–≤–∞–Ω–∏–µ, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, –ø–æ—Ä–æ–≥ }) {
        const card = document.createElement('div');
        card.className = 'task-subcard low-stock';

        const left = document.createElement('div');
        left.className = 'task-subcard-left';

        const nameEl = document.createElement('div');
        nameEl.className = 'task-name';
        nameEl.textContent = –Ω–∞–∑–≤–∞–Ω–∏–µ;
        left.appendChild(nameEl);

        const currentEl = document.createElement('div');
        currentEl.className = 'task-type';
        currentEl.textContent = `–¢–µ–∫—É—â–∏–π –∑–∞–ø–∞—Å: ${–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ}`;
        left.appendChild(currentEl);

        const minimumEl = document.createElement('div');
        minimumEl.className = 'task-deadline';
        minimumEl.textContent = `–ú–∏–Ω–∏–º—É–º: ${–ø–æ—Ä–æ–≥}`;
        left.appendChild(minimumEl);

        card.appendChild(left);
        document.getElementById('lowStockAlerts').appendChild(card);
      }

    fetch('/api/active-requests')
      .then(res => res.json())
      .then(tasks => {
        tasks.forEach(task => addTaskCard(task));
      });

    fetch('/api/active-count')
      .then(res => res.json())
      .then(data => {
        document.getElementById('activeCount').textContent = data.count;
      });

    fetch('/api/low-stock')
      .then(res => res.json())
      .then(parts => {
        document.getElementById('lowStockCount').textContent = parts.length;
        parts.forEach(part => addStockCard(part));
      });
  </script>
</body>
</html>
