<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ú–æ–∏ –∑–∞—è–≤–∫–∏</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='Requests.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>
  <div class="requests-wrapper">
    <h2>–ú–æ–∏ –∑–∞—è–≤–∫–∏</h2>

    <a href="{{ url_for('client.user_panel') }}" class="back-button">
      ‚Üê –ù–∞–∑–∞–¥
    </a>

    <div class="status-block">
      <h3 class="status-title">üïì –í –æ–∂–∏–¥–∞–Ω–∏–∏</h3>
      <div id="pendingRequests" class="request-list"></div>
    </div>

    <div class="status-block">
      <h3 class="status-title">üîß –í —Ä–∞–±–æ—Ç–µ</h3>
      <div id="inProgressRequests" class="request-list"></div>
    </div>

    <div class="status-block">
      <h3 class="status-title">üí∞ –í –æ–∂–∏–¥–∞–Ω–∏–∏ –æ–ø–ª–∞—Ç—ã</h3>
      <div id="paymentRequests" class="request-list"></div>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const pendingContainer = document.getElementById("pendingRequests");
      const inProgressContainer = document.getElementById("inProgressRequests");
      const paymentContainer = document.getElementById("paymentRequests");

      fetch("/api/my-requests")
        .then(response => {
          if (!response.ok) {
            throw new Error("–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: " + response.status);
          }
          return response.json();
        })
        .then(data => {
          if (!Array.isArray(data) || data.length === 0) {
            pendingContainer.innerHTML = "<p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞—è–≤–æ–∫.</p>";
            inProgressContainer.innerHTML = "";
            paymentContainer.innerHTML = "";
            return;
          }

          pendingContainer.innerHTML = "";
          inProgressContainer.innerHTML = "";
          paymentContainer.innerHTML = "";

          data.forEach(task => {
            const card = document.createElement("div");
            card.className = "request-card";
            card.innerHTML = `
              <h3>${task.name}</h3>
              <p><strong>–°—Ç–∞—Ç—É—Å:</strong> ${task.type}</p>
              <p><strong>–î–∞—Ç–∞ –∑–∞—è–≤–∫–∏:</strong> ${task.deadline}</p>
              <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> ${task.description}</p>
            `;

            const status = task.type.toLowerCase();

            if (status === "–Ω–æ–≤–∞—è" || status === "–≤ –æ–∂–∏–¥–∞–Ω–∏–∏") {
              pendingContainer.appendChild(card);
            } else if (status === "–≤ —Ä–∞–±–æ—Ç–µ") {
              inProgressContainer.appendChild(card);
            } else if (status === "–≤ –æ–∂–∏–¥–∞–Ω–∏–∏ –æ–ø–ª–∞—Ç—ã") {
              paymentContainer.appendChild(card);
            }
          });
        })
        .catch(error => {
          console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∑–∞—è–≤–æ–∫:", error);
          pendingContainer.innerHTML = "<p>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∑–∞—è–≤–∫–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.</p>";
          inProgressContainer.innerHTML = "";
          paymentContainer.innerHTML = "";
        });
    });
  </script>
</body>
</html>